import { createResolver } from '@nuxt/kit'
import { $fetch, setup } from '@nuxt/test-utils/e2e'
import { describe, expect, it } from 'vitest'

const { resolve } = createResolver(import.meta.url)

await setup({
  rootDir: resolve('../fixtures/basic'),
  dev: true,
})

describe('dev', () => {
  it('svg', async () => {
    const svg = await $fetch('/__og-image__/image/satori/og.svg')
    expect(svg).toMatchInlineSnapshot(`
      Blob {
        Symbol(kHandle): Blob {},
        Symbol(kLength): 14641,
        Symbol(kType): "image/svg+xml",
      }
    `)
  }, 60000)

  it('json', async () => {
    const json = await $fetch('/__og-image__/image/satori/og.json')
    delete json.key
    json.options.component = json.options.component.replace('OgImage', '')
    expect(json).toMatchInlineSnapshot(`
      {
        "cacheKey": "satori:85xUPyRysj54MgqRPbu0CZWgsg_WmC4BeJvBJez5bVw",
        "compatibilityHints": [],
        "options": {
          "cacheMaxAgeSeconds": 259200,
          "component": "NuxtSeo",
          "emojis": "noto",
          "extension": "png",
          "height": 600,
          "props": {
            "title": "Hello World",
          },
          "renderer": "satori",
          "socialPreview": {
            "og": {
              "image": "https://nuxtseo.com/__og-image__/image/satori/og.png",
              "image:height": "600",
              "image:type": "image/png",
              "image:width": "1200",
            },
            "twitter": {
              "card": "summary_large_image",
              "image": "https://nuxtseo.com/__og-image__/image/satori/og.png",
              "image:height": "600",
              "image:src": "https://nuxtseo.com/__og-image__/image/satori/og.png",
              "image:width": "1200",
            },
          },
          "width": 1200,
        },
        "siteConfig": {
          "url": "https://nuxtseo.com",
        },
        "svg": "<svg width="1200" height="600" viewBox="0 0 1200 600" xmlns="http://www.w3.org/2000/svg"><mask id="satori_om-id"><rect x="0" y="0" width="1200" height="600" fill="#fff"/></mask><clipPath id="satori_cp-id-0"><rect x="0" y="0" width="1200" height="600"/></clipPath><mask id="satori_om-id-0"><rect x="0" y="0" width="1200" height="600" fill="#fff"/></mask><mask id="satori_om-id-0-0"><rect x="0" y="0" width="1200" height="600" fill="#fff" mask="url(#satori_om-id-0)"/></mask><rect x="0" y="0" width="1200" height="600" fill="rgb(255, 255, 255)" clip-path="url(#satori_cp-id-0)" mask="url(#satori_om-id-0)"/><defs><pattern id="satori_pattern_id-0-0-0_0" x="0" y="0" width="1" height="1" patternUnits="objectBoundingBox"><radialGradient id="satori_radial_id-0-0-0_0"><stop offset="0" stop-color="rgba(0, 220, 130, 0.5)"/><stop offset="0.5" stop-color="rgba(255, 255, 255, 0.7)"/><stop offset="0.7" stop-color="rgba(255, 255, 255, 0)"/><stop offset="1" stop-color="rgba(255, 255, 255, 0)"/></radialGradient><mask id="satori_mask_id-0-0-0_0"><rect x="0" y="0" width="2160" height="960" fill="#fff"/></mask><rect x="0" y="0" width="2160" height="960" fill="rgba(255, 255, 255, 0)"/><circle cx="1080" cy="480" width="2160" height="960" r="1181.8629362155325" fill="url(#satori_radial_id-0-0-0_0)" mask="url(#satori_mask_id-0-0-0_0)"/></pattern></defs><mask id="satori_om-id-0-0-0"><rect x="120" y="0" width="2160" height="960" fill="#fff" mask="url(#satori_om-id-0)"/></mask><rect x="120" y="0" width="2160" height="960" fill="url(#satori_pattern_id-0-0-0_0)" clip-path="url(#satori_cp-id-0)" mask="url(#satori_om-id-0)"/><mask id="satori_om-id-0-0-1"><rect x="60" y="60" width="1080" height="480" fill="#fff" mask="url(#satori_om-id-0)"/></mask><mask id="satori_om-id-0-0-1-0"><rect x="60" y="60" width="1080" height="121" fill="#fff" mask="url(#satori_om-id-0)"/></mask><mask id="satori_om-id-0-0-1-0-0"><rect x="60" y="60" width="702" height="121" fill="#fff" mask="url(#satori_om-id-0)"/></mask><mask id="satori_om-id-0-0-1-0-0-0"><rect x="60" y="60" width="702" height="91" fill="#fff" mask="url(#satori_om-id-0)"/></mask><g mask="url(#satori_om-id-0)" clip-path="url(#satori_cp-id-0)"><path fill="rgb(17, 24, 39)" d="M76.3 133L64.7 133L64.7 78.5L76.3 78.5L76.3 101.0L99.7 101.0L99.7 78.5L111.2 78.5L111.2 133L99.7 133L99.7 110.5L76.3 110.5L76.3 133ZM139.1 133.8L139.1 133.8Q132.8 133.8 128.3 131.2Q123.7 128.7 121.3 123.9Q118.8 119.2 118.8 112.7L118.8 112.7Q118.8 106.4 121.3 101.7Q123.7 96.9 128.2 94.2Q132.7 91.6 138.7 91.6L138.7 91.6Q142.7 91.6 146.2 92.8Q149.7 94.1 152.4 96.7Q155.0 99.3 156.4 103.2Q157.9 107.1 157.9 112.3L157.9 112.3L157.9 115.4L130.0 115.4L130.0 115.5Q130.0 118.5 131.2 120.7Q132.3 122.9 134.4 124.1Q136.5 125.3 139.3 125.3L139.3 125.3Q141.2 125.3 142.8 124.8Q144.3 124.3 145.5 123.2Q146.6 122.1 147.2 120.6L147.2 120.6L157.7 121.3Q156.9 125.1 154.4 127.9Q151.9 130.7 148.1 132.2Q144.2 133.8 139.1 133.8ZM130.0 108.4L130.0 108.4L147.2 108.4Q147.2 106.0 146.2 104.1Q145.1 102.2 143.2 101.1Q141.3 100.0 138.9 100.0L138.9 100.0Q136.3 100.0 134.3 101.2Q132.3 102.4 131.2 104.4L131.2 104.4Q130.2 106.2 130.0 108.4ZM165.3 78.5L176.7 78.5L176.7 133L165.3 133L165.3 78.5ZM185.7 78.5L197.1 78.5L197.1 133L185.7 133L185.7 78.5ZM224.6 133.8L224.6 133.8Q218.4 133.8 213.9 131.1Q209.4 128.5 206.9 123.7Q204.5 119.0 204.5 112.7L204.5 112.7Q204.5 106.4 206.9 101.6Q209.4 96.9 213.9 94.2Q218.4 91.6 224.6 91.6L224.6 91.6Q230.8 91.6 235.3 94.2Q239.8 96.9 242.3 101.6Q244.7 106.4 244.7 112.7L244.7 112.7Q244.7 119.0 242.3 123.7Q239.8 128.5 235.3 131.1Q230.8 133.8 224.6 133.8ZM224.6 125.0L224.6 125.0Q227.5 125.0 229.4 123.4Q231.3 121.8 232.2 119.0Q233.2 116.2 233.2 112.6L233.2 112.6Q233.2 109.1 232.2 106.3Q231.3 103.5 229.4 101.8Q227.5 100.2 224.6 100.2L224.6 100.2Q221.8 100.2 219.9 101.8Q217.9 103.5 217.0 106.3Q216.0 109.1 216.0 112.6L216.0 112.6Q216.0 116.2 217.0 119.0Q217.9 121.8 219.9 123.4Q221.8 125.0 224.6 125.0Z M293.3 133L282.0 133L266.4 78.5L279.0 78.5L288.0 116.4L288.5 116.4L298.4 78.5L309.2 78.5L319.2 116.4L319.7 116.4L328.7 78.5L341.3 78.5L325.7 133L314.4 133L304.0 97.3L303.6 97.3L293.3 133ZM365.7 133.8L365.7 133.8Q359.5 133.8 355.0 131.1Q350.5 128.5 348.0 123.7Q345.6 119.0 345.6 112.7L345.6 112.7Q345.6 106.4 348.0 101.6Q350.5 96.9 355.0 94.2Q359.5 91.6 365.7 91.6L365.7 91.6Q371.9 91.6 376.4 94.2Q380.9 96.9 383.4 101.6Q385.8 106.4 385.8 112.7L385.8 112.7Q385.8 119.0 383.4 123.7Q380.9 128.5 376.4 131.1Q371.9 133.8 365.7 133.8ZM365.8 125.0L365.8 125.0Q368.6 125.0 370.5 123.4Q372.4 121.8 373.3 119.0Q374.3 116.2 374.3 112.6L374.3 112.6Q374.3 109.1 373.3 106.3Q372.4 103.5 370.5 101.8Q368.6 100.2 365.8 100.2L365.8 100.2Q362.9 100.2 361.0 101.8Q359.0 103.5 358.1 106.3Q357.1 109.1 357.1 112.6L357.1 112.6Q357.1 116.2 358.1 119.0Q359.0 121.8 361.0 123.4Q362.9 125.0 365.8 125.0ZM404.6 133L393.2 133L393.2 92.1L404.2 92.1L404.2 99.2L404.7 99.2Q405.8 95.4 408.4 93.5Q411.1 91.5 414.5 91.5L414.5 91.5Q415.3 91.5 416.3 91.6Q417.3 91.7 418.1 91.9L418.1 91.9L418.1 102.0Q417.3 101.7 415.9 101.5Q414.4 101.4 413.3 101.4L413.3 101.4Q410.8 101.4 408.8 102.4Q406.8 103.5 405.7 105.4Q404.6 107.4 404.6 109.9L404.6 109.9L404.6 133ZM423.9 78.5L435.2 78.5L435.2 133L423.9 133L423.9 78.5ZM459.4 133.7L459.4 133.7Q454.7 133.7 450.9 131.3Q447.2 128.8 445.0 124.1Q442.8 119.4 442.8 112.6L442.8 112.6Q442.8 105.6 445.0 100.9Q447.3 96.2 451.1 93.9Q454.8 91.6 459.3 91.6L459.3 91.6Q462.8 91.6 465.1 92.7Q467.4 93.9 468.8 95.6Q470.2 97.3 471.0 99.0L471.0 99.0L471.3 99.0L471.3 78.5L482.6 78.5L482.6 133L471.5 133L471.5 126.4L471.0 126.4Q470.2 128.2 468.7 129.8Q467.3 131.5 465.0 132.6Q462.7 133.7 459.4 133.7ZM463.0 124.6L463.0 124.6Q465.7 124.6 467.6 123.1Q469.5 121.6 470.5 118.9Q471.6 116.2 471.6 112.5L471.6 112.5Q471.6 108.9 470.6 106.2Q469.5 103.5 467.6 102.1Q465.7 100.6 463.0 100.6L463.0 100.6Q460.2 100.6 458.3 102.1Q456.3 103.6 455.3 106.3Q454.4 109.0 454.4 112.5L454.4 112.5Q454.4 116.1 455.4 118.8Q456.4 121.6 458.3 123.1Q460.2 124.6 463.0 124.6Z "/></g><mask id="satori_om-id-0-0-1-1"><rect x="60" y="478" width="1080" height="62" fill="#fff" mask="url(#satori_om-id-0)"/></mask><clipPath id="satori_cp-id-0-0-1-1-0" clip-path="url(#satori_cp-id-0)"><rect x="477" y="484" width="50" height="50"/></clipPath><mask id="satori_om-id-0-0-1-1-0"><rect x="477" y="484" width="50" height="50" fill="#fff" mask="url(#satori_om-id-0)"/></mask><image x="477" y="484" width="50" height="50" href="data:image/svg+xml;utf8,%3Csvg  class=%22%22 xmlns=%22http://www.w3.org/2000/svg%22 tw=%22%22 width=%2250%22 height=%2250%22 viewBox=%220 0 200 200%22%3E%3Cpath fill=%22%2300dc82%22 d=%22M62.3,-53.9C74.4,-34.5,73.5,-9,67.1,13.8C60.6,36.5,48.7,56.5,30.7,66.1C12.7,75.7,-11.4,74.8,-31.6,65.2C-51.8,55.7,-67.9,37.4,-73.8,15.7C-79.6,-6,-75.1,-31.2,-61.1,-51C-47.1,-70.9,-23.6,-85.4,0.8,-86C25.1,-86.7,50.2,-73.4,62.3,-53.9Z%22 transform=%22translate(100 100)%22%3E%3C/path%3E%3C/svg%3E" preserveAspectRatio="none" clip-path="url(#satori_cp-id-0-0-1-1-0)" mask="url(#satori_om-id-0-0-1-1-0)"/><mask id="satori_om-id-0-0-1-1-0-0"><rect x="477" y="484" width="0" height="50" fill="#fff" mask="url(#satori_om-id-0)"/></mask><mask id="satori_om-id-0-0-1-1-1"><rect x="539" y="494" width="185" height="30" fill="#fff" mask="url(#satori_om-id-0)"/></mask><g mask="url(#satori_om-id-0)" clip-path="url(#satori_cp-id-0)"><path fill="rgb(17, 24, 39)" d="M544.3 510.1L544.3 510.1L544.3 518L540.5 518L540.5 504.4L544.1 504.4L544.1 506.8L544.3 506.8Q544.7 505.6 545.8 504.9Q546.9 504.2 548.4 504.2L548.4 504.2Q549.8 504.2 550.9 504.8Q551.9 505.4 552.5 506.6Q553.1 507.7 553.1 509.3L553.1 509.3L553.1 518L549.3 518L549.3 510.0Q549.3 508.7 548.7 508.0Q548.0 507.3 546.9 507.3L546.9 507.3Q546.1 507.3 545.5 507.7Q544.9 508.0 544.6 508.6Q544.3 509.2 544.3 510.1ZM564.8 512.2L564.8 512.2L564.8 504.4L568.6 504.4L568.6 518L564.9 518L564.9 515.5L564.8 515.5Q564.3 516.7 563.3 517.4Q562.2 518.2 560.7 518.2L560.7 518.2Q559.3 518.2 558.3 517.6Q557.2 516.9 556.6 515.8Q556.1 514.6 556.1 513.0L556.1 513.0L556.1 504.4L559.8 504.4L559.8 512.4Q559.8 513.6 560.5 514.3Q561.1 515.0 562.2 515.0L562.2 515.0Q562.9 515.0 563.5 514.7Q564.1 514.4 564.4 513.7Q564.8 513.1 564.8 512.2ZM570.9 504.4L574.8 504.4L577.3 509.1L579.8 504.4L583.7 504.4L579.8 511.2L583.8 518L580.0 518L577.3 513.3L574.6 518L570.7 518L574.8 511.2L570.9 504.4ZM590.6 504.4L593.2 504.4L593.2 507.2L590.6 507.2L590.6 513.8Q590.6 514.3 590.8 514.6Q591.0 514.9 591.2 515.0Q591.5 515.1 591.9 515.1L591.9 515.1Q592.2 515.1 592.4 515.1Q592.7 515.0 592.9 515.0L592.9 515.0L593.4 517.8Q593.2 517.9 592.6 518.0Q592.1 518.2 591.4 518.2L591.4 518.2Q590.0 518.2 589.0 517.8Q588.0 517.4 587.4 516.5Q586.8 515.6 586.9 514.3L586.9 514.3L586.9 507.2L585.0 507.2L585.0 504.4L586.9 504.4L586.9 501.1L590.6 501.1L590.6 504.4ZM595.9 509.0L604.2 509.0L604.2 512.0L595.9 512.0L595.9 509.0ZM613.5 518.3L613.5 518.3Q611.5 518.3 610.0 517.4Q608.5 516.5 607.6 514.9Q606.8 513.3 606.8 511.2L606.8 511.2Q606.8 509.1 607.6 507.5Q608.5 506.0 610.0 505.1Q611.5 504.2 613.5 504.2L613.5 504.2Q615.6 504.2 617.1 505.1Q618.6 506.0 619.4 507.5Q620.2 509.1 620.2 511.2L620.2 511.2Q620.2 513.3 619.4 514.9Q618.6 516.5 617.1 517.4Q615.6 518.3 613.5 518.3ZM613.6 515.3L613.6 515.3Q614.5 515.3 615.1 514.8Q615.8 514.3 616.1 513.3Q616.4 512.4 616.4 511.2L616.4 511.2Q616.4 510.0 616.1 509.1Q615.8 508.2 615.1 507.6Q614.5 507.1 613.6 507.1L613.6 507.1Q612.6 507.1 612.0 507.6Q611.3 508.2 611.0 509.1Q610.7 510.0 610.7 511.2L610.7 511.2Q610.7 512.4 611.0 513.3Q611.3 514.3 612.0 514.8Q612.6 515.3 613.6 515.3ZM628.9 523.4L628.9 523.4Q627.0 523.4 625.7 522.9Q624.4 522.4 623.6 521.5Q622.9 520.7 622.6 519.6L622.6 519.6L626.1 519.1Q626.3 519.5 626.6 519.9Q627.0 520.2 627.6 520.5Q628.1 520.7 629.0 520.7L629.0 520.7Q630.2 520.7 631.0 520.1Q631.8 519.5 631.8 518.1L631.8 518.1L631.8 515.6L631.6 515.6Q631.4 516.2 630.9 516.7Q630.4 517.2 629.6 517.5Q628.8 517.8 627.7 517.8L627.7 517.8Q626.2 517.8 625.0 517.1Q623.7 516.4 623.0 514.9Q622.2 513.4 622.2 511.2L622.2 511.2Q622.2 508.8 623.0 507.3Q623.7 505.7 625.0 505.0Q626.2 504.2 627.7 504.2L627.7 504.2Q628.9 504.2 629.7 504.6Q630.4 505.0 630.9 505.5Q631.4 506.1 631.6 506.7L631.6 506.7L631.8 506.7L631.8 504.4L635.5 504.4L635.5 518.1Q635.5 519.9 634.7 521.0Q633.8 522.2 632.3 522.8Q630.8 523.4 628.9 523.4ZM628.9 515.0L628.9 515.0Q629.9 515.0 630.5 514.5Q631.1 514.0 631.5 513.2Q631.8 512.3 631.8 511.1L631.8 511.1Q631.8 509.9 631.5 509.1Q631.1 508.2 630.5 507.7Q629.9 507.2 628.9 507.2L628.9 507.2Q628.0 507.2 627.4 507.7Q626.7 508.2 626.4 509.1Q626.1 510.0 626.1 511.1L626.1 511.1Q626.1 512.3 626.4 513.2Q626.7 514.0 627.4 514.5Q628.0 515.0 628.9 515.0ZM638.8 509.0L647.0 509.0L647.0 512.0L638.8 512.0L638.8 509.0ZM654.0 518L650.3 518L650.3 504.4L654.0 504.4L654.0 518ZM652.2 502.6L652.2 502.6Q651.3 502.6 650.7 502.0Q650.1 501.5 650.1 500.7L650.1 500.7Q650.1 499.9 650.7 499.3Q651.3 498.8 652.2 498.8L652.2 498.8Q653.0 498.8 653.6 499.3Q654.2 499.9 654.2 500.7L654.2 500.7Q654.2 501.5 653.6 502.0Q653.0 502.6 652.2 502.6ZM660.8 518L657.1 518L657.1 504.4L660.7 504.4L660.7 506.8L660.8 506.8Q661.3 505.6 662.3 504.9Q663.2 504.2 664.6 504.2L664.6 504.2Q666.0 504.2 667.0 504.9Q668.0 505.6 668.3 506.8L668.3 506.8L668.5 506.8Q668.9 505.6 670.0 504.9Q671.1 504.2 672.6 504.2L672.6 504.2Q674.5 504.2 675.7 505.4Q676.9 506.6 676.9 508.8L676.9 508.8L676.9 518L673.1 518L673.1 509.6Q673.1 508.4 672.5 507.9Q671.9 507.3 671.0 507.3L671.0 507.3Q670.0 507.3 669.4 508.0Q668.8 508.6 668.8 509.7L668.8 509.7L668.8 518L665.1 518L665.1 509.5Q665.1 508.5 664.6 507.9Q664 507.3 663.1 507.3L663.1 507.3Q662.4 507.3 661.9 507.6Q661.4 507.9 661.1 508.5Q660.8 509.1 660.8 509.8L660.8 509.8L660.8 518ZM683.8 518.3L683.8 518.3Q682.4 518.3 681.4 517.8Q680.4 517.3 679.8 516.4Q679.2 515.5 679.2 514.2L679.2 514.2Q679.2 513.1 679.6 512.3Q680.1 511.5 680.8 511.0Q681.5 510.6 682.4 510.3Q683.3 510.1 684.3 510.0L684.3 510.0Q685.5 509.9 686.3 509.8Q687.0 509.6 687.3 509.4Q687.7 509.2 687.7 508.8L687.7 508.8L687.7 508.7Q687.7 507.9 687.1 507.4Q686.6 506.9 685.6 506.9L685.6 506.9Q684.6 506.9 684.0 507.4Q683.4 507.8 683.2 508.5L683.2 508.5L679.7 508.2Q680.0 507.0 680.8 506.1Q681.5 505.2 682.8 504.7Q684.0 504.2 685.6 504.2L685.6 504.2Q686.8 504.2 687.8 504.5Q688.9 504.7 689.7 505.3Q690.5 505.8 691.0 506.7Q691.4 507.6 691.4 508.8L691.4 508.8L691.4 518L687.8 518L687.8 516.1L687.7 516.1Q687.4 516.7 686.9 517.2Q686.3 517.7 685.5 518.0Q684.8 518.3 683.8 518.3ZM684.8 515.6L684.8 515.6Q685.7 515.6 686.3 515.3Q686.9 515.0 687.3 514.4Q687.7 513.8 687.7 513.1L687.7 513.1L687.7 511.7Q687.5 511.8 687.2 511.9Q686.9 512.0 686.5 512.1Q686.1 512.1 685.7 512.2Q685.4 512.2 685.0 512.3L685.0 512.3Q684.4 512.4 683.9 512.6Q683.4 512.8 683.1 513.2Q682.8 513.5 682.8 514.1L682.8 514.1Q682.8 514.8 683.4 515.2Q684.0 515.6 684.8 515.6ZM700.5 523.4L700.5 523.4Q698.7 523.4 697.4 522.9Q696.1 522.4 695.3 521.5Q694.5 520.7 694.3 519.6L694.3 519.6L697.8 519.1Q697.9 519.5 698.3 519.9Q698.6 520.2 699.2 520.5Q699.8 520.7 700.6 520.7L700.6 520.7Q701.8 520.7 702.6 520.1Q703.4 519.5 703.4 518.1L703.4 518.1L703.4 515.6L703.3 515.6Q703.0 516.2 702.5 516.7Q702.0 517.2 701.3 517.5Q700.5 517.8 699.4 517.8L699.4 517.8Q697.9 517.8 696.6 517.1Q695.3 516.4 694.6 514.9Q693.9 513.4 693.9 511.2L693.9 511.2Q693.9 508.8 694.6 507.3Q695.4 505.7 696.6 505.0Q697.9 504.2 699.4 504.2L699.4 504.2Q700.5 504.2 701.3 504.6Q702.1 505.0 702.6 505.5Q703.0 506.1 703.3 506.7L703.3 506.7L703.4 506.7L703.4 504.4L707.2 504.4L707.2 518.1Q707.2 519.9 706.3 521.0Q705.5 522.2 704.0 522.8Q702.5 523.4 700.5 523.4ZM700.6 515.0L700.6 515.0Q701.5 515.0 702.1 514.5Q702.8 514.0 703.1 513.2Q703.5 512.3 703.5 511.1L703.5 511.1Q703.5 509.9 703.1 509.1Q702.8 508.2 702.1 507.7Q701.5 507.2 700.6 507.2L700.6 507.2Q699.7 507.2 699.0 507.7Q698.4 508.2 698.1 509.1Q697.7 510.0 697.7 511.1L697.7 511.1Q697.7 512.3 698.1 513.2Q698.4 514.0 699.0 514.5Q699.7 515.0 700.6 515.0ZM716.4 518.3L716.4 518.3Q714.3 518.3 712.8 517.4Q711.3 516.6 710.5 515.0Q709.6 513.4 709.6 511.2L709.6 511.2Q709.6 509.1 710.5 507.6Q711.3 506.0 712.8 505.1Q714.3 504.2 716.3 504.2L716.3 504.2Q717.6 504.2 718.8 504.6Q719.9 505.0 720.8 505.9Q721.7 506.8 722.2 508.1Q722.7 509.4 722.7 511.1L722.7 511.1L722.7 512.1L713.4 512.1L713.4 512.2Q713.4 513.2 713.8 513.9Q714.1 514.6 714.8 515.0Q715.5 515.4 716.5 515.4L716.5 515.4Q717.1 515.4 717.6 515.3Q718.2 515.1 718.5 514.7Q718.9 514.4 719.1 513.9L719.1 513.9L722.6 514.1Q722.3 515.4 721.5 516.3Q720.7 517.2 719.4 517.7Q718.1 518.3 716.4 518.3ZM713.4 509.8L713.4 509.8L719.1 509.8Q719.1 509.0 718.8 508.4Q718.4 507.7 717.8 507.4Q717.2 507.0 716.3 507.0L716.3 507.0Q715.5 507.0 714.8 507.4Q714.1 507.8 713.8 508.5L713.8 508.5Q713.4 509.1 713.4 509.8Z "/></g></svg>",
        "vnodes": {
          "props": {
            "children": [
              {
                "props": {
                  "children": [
                    {
                      "props": {
                        "children": [
                          {
                            "props": {
                              "class": "",
                              "style": {
                                "backgroundImage": "radial-gradient(circle, rgba(0, 220, 130, 0.5) 0%,  rgba(255, 255, 255, 0.7) 50%, rgba(255, 255, 255, 0) 70%)",
                                "display": "flex",
                                "height": "200%",
                                "position": "absolute",
                                "right": "-100%",
                                "top": "0",
                                "width": "200%",
                              },
                              "tw": "",
                            },
                            "type": "div",
                          },
                          {
                            "props": {
                              "children": [
                                {
                                  "props": {
                                    "children": [
                                      {
                                        "props": {
                                          "children": [
                                            {
                                              "props": {
                                                "children": "Hello World",
                                                "class": "",
                                                "style": {
                                                  "display": "block",
                                                  "fontSize": "75px",
                                                  "fontWeight": "700",
                                                  "lineClamp": "3",
                                                  "margin": "0",
                                                  "marginBottom": "30px",
                                                  "textOverflow": "ellipsis",
                                                },
                                                "tw": "",
                                              },
                                              "type": "h1",
                                            },
                                          ],
                                          "class": "",
                                          "style": {
                                            "display": "flex",
                                            "flexDirection": "column",
                                            "maxWidth": "65%",
                                            "width": "100%",
                                          },
                                          "tw": "",
                                        },
                                        "type": "div",
                                      },
                                    ],
                                    "class": "",
                                    "style": {
                                      "alignItems": "flex-start",
                                      "display": "flex",
                                      "flexDirection": "row",
                                      "justifyContent": "space-between",
                                    },
                                    "tw": "",
                                  },
                                  "type": "div",
                                },
                                {
                                  "props": {
                                    "children": [
                                      null,
                                      {
                                        "props": {
                                          "children": [
                                            {
                                              "props": {
                                                "d": "M62.3,-53.9C74.4,-34.5,73.5,-9,67.1,13.8C60.6,36.5,48.7,56.5,30.7,66.1C12.7,75.7,-11.4,74.8,-31.6,65.2C-51.8,55.7,-67.9,37.4,-73.8,15.7C-79.6,-6,-75.1,-31.2,-61.1,-51C-47.1,-70.9,-23.6,-85.4,0.8,-86C25.1,-86.7,50.2,-73.4,62.3,-53.9Z",
                                                "fill": "#00dc82",
                                                "transform": "translate(100 100)",
                                              },
                                              "type": "path",
                                            },
                                          ],
                                          "class": "",
                                          "height": "50",
                                          "style": {
                                            "marginRight": "0.75rem",
                                          },
                                          "tw": "",
                                          "viewBox": "0 0 200 200",
                                          "width": "50",
                                          "xmlns": "http://www.w3.org/2000/svg",
                                        },
                                        "type": "svg",
                                      },
                                      {
                                        "props": {
                                          "children": "nuxt-og-image",
                                          "class": "",
                                          "style": {
                                            "fontSize": "25px",
                                            "fontWeight": "700",
                                          },
                                          "tw": "",
                                        },
                                        "type": "p",
                                      },
                                    ],
                                    "class": "",
                                    "style": {
                                      "alignItems": "center",
                                      "display": "flex",
                                      "flexDirection": "row",
                                      "justifyContent": "center",
                                      "textAlign": "left",
                                      "width": "100%",
                                    },
                                    "tw": "",
                                  },
                                  "type": "div",
                                },
                              ],
                              "class": "",
                              "style": {
                                "display": "flex",
                                "flexDirection": "column",
                                "height": "100%",
                                "justifyContent": "space-between",
                                "position": "relative",
                                "width": "100%",
                              },
                              "tw": "",
                            },
                            "type": "div",
                          },
                        ],
                        "class": "",
                        "data-island-uid": "",
                        "style": {
                          "backgroundColor": "rgb(255, 255, 255)",
                          "color": "rgb(17, 24, 39)",
                          "display": "flex",
                          "flexDirection": "column",
                          "height": "100%",
                          "justifyContent": "space-between",
                          "padding": "60px",
                          "position": "relative",
                          "width": "100%",
                        },
                        "tw": "",
                      },
                      "type": "div",
                    },
                  ],
                  "style": {
                    "display": "flex",
                    "flexDirection": "column",
                    "height": "600px",
                    "margin": "0 auto",
                    "overflow": "hidden",
                    "position": "relative",
                    "width": "1200px",
                  },
                },
                "type": "div",
              },
            ],
            "style": {
              "display": "flex",
              "flexDirection": "column",
              "height": "100%",
              "width": "100%",
            },
          },
          "type": "div",
        },
      }
    `)
  }, 60000)

  it('html', async () => {
    const font = await $fetch('/__og-image__/image/satori/og.html')
    expect(font).toContain('<!DOCTYPE html>')
  }, 60000)
  it('debug.json', async () => {
    const debug = await $fetch('/__og-image__/debug.json')
    delete debug.runtimeConfig.baseCacheKey
    delete debug.runtimeConfig.version
    delete debug.runtimeConfig.compatibility
    delete debug.componentNames
    delete debug.baseCacheKey
    delete debug.compatibility // github ci will have playwright
    expect(debug).toMatchInlineSnapshot(`
      {
        "runtimeConfig": {
          "app": {
            "baseURL": "/",
          },
          "colorPreference": "light",
          "componentDirs": [
            "OgImage",
            "og-image",
            "OgImageTemplate",
          ],
          "debug": true,
          "defaults": {
            "cacheMaxAgeSeconds": 259200,
            "component": "NuxtSeo",
            "emojis": "noto",
            "extension": "png",
            "height": 600,
            "renderer": "satori",
            "width": 1200,
          },
          "fonts": [
            {
              "cacheKey": "Inter:undefined:400",
              "key": "nuxt-og-image:fonts:Inter-normal-400.ttf.base64",
              "name": "Inter",
              "style": "normal",
              "weight": 400,
            },
            {
              "cacheKey": "Inter:undefined:700",
              "key": "nuxt-og-image:fonts:Inter-normal-700.ttf.base64",
              "name": "Inter",
              "style": "normal",
              "weight": 700,
            },
          ],
          "hasNuxtIcon": false,
          "isNuxtContentDocumentDriven": false,
          "publicStoragePath": "root:public",
          "resvgOptions": {},
          "satoriOptions": {},
          "sharpOptions": {},
          "strictNuxtContentPaths": "",
        },
        "siteConfigUrl": "https://nuxtseo.com",
      }
    `)
  }, 60000)
})
